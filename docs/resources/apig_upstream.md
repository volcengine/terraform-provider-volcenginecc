---
page_title: "volcenginecc_apig_upstream Resource - terraform-provider-volcenginecc"
subcategory: ""
description: |-
  Upstream 是对 API 网关实例后端的抽象。您可以将具有相同功能的后端应用抽象为一个 Upstream，实现路由和后端应用解耦，更灵活地支持后端应用的灰度发布、多版本管理等场景。本文为您介绍 Upstream 的概念及作用。
---

# volcenginecc_apig_upstream (Resource)

Upstream 是对 API 网关实例后端的抽象。您可以将具有相同功能的后端应用抽象为一个 Upstream，实现路由和后端应用解耦，更灵活地支持后端应用的灰度发布、多版本管理等场景。本文为您介绍 Upstream 的概念及作用。

## Example Usage

```terraform
resource "volcenginecc_apig_upstream" "APIGUpstreamAIProviderDemo" {
  name        = "APIGUpstreamAIProviderDemo"
  gateway_id  = "gd45elb819ma6giexxxxx"
  comments    = "APIGUpstreamAIProviderDemo"
  protocol    = "HTTP"
  source_type = "K8S"
  upstream_spec = {
    k8_s_service = {
      namespace = "namespace"
      name      = "server"
      port      = 2001
    }
  }
  load_balancer_settings = {
    lb_policy = "SimpleLB"
    simple_lb = "RANDOM"
  }
  circuit_breaking_settings = {
    enable               = true
    consecutive_errors   = 5
    interval             = 10000
    base_ejection_time   = 30000
    max_ejection_percent = 20
    min_health_percent   = 60
  }
  tls_settings = {
    tls_mode = "DISABLE"
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `gateway_id` (String) 网关实例ID。
- `name` (String) Upstream名称。
- `source_type` (String) Upstream来源类型，取值：VeFaas：函数服务。ECS：云服务器。K8S：容器服务。Nacos：注册中心。AIProvider：AI模型代理。
- `upstream_spec` (Attributes) Upstream配置。 (see [below for nested schema](#nestedatt--upstream_spec))

### Optional

- `circuit_breaking_settings` (Attributes) 服务熔断配置。 (see [below for nested schema](#nestedatt--circuit_breaking_settings))
- `comments` (String) 备注。
- `load_balancer_settings` (Attributes) 负载均衡配置。 (see [below for nested schema](#nestedatt--load_balancer_settings))
- `protocol` (String) 协议，取值：HTTP：HTTP/1.1。HTTP2：HTTP/2。GRPC：GRPC。
- `tls_settings` (Attributes) TLS配置。 (see [below for nested schema](#nestedatt--tls_settings))

### Read-Only

- `backend_targets` (Attributes Set) 后端节点，Upstream来源类型为VeFaas时无效。
 特别提示: 在使用 ListNestedAttribute 或 SetNestedAttribute 时，必须完整定义其嵌套结构体的所有属性。若定义不完整，Terraform 在执行计划对比时可能会检测到意料之外的差异，从而触发不必要的资源更新，影响资源的稳定性与可预测性。 (see [below for nested schema](#nestedatt--backend_targets))
- `created_time` (String) Upstream创建时间。
- `id` (String) Uniquely identifies the resource.
- `updated_time` (String) Upstream更新时间。
- `upstream_id` (String) Upstream ID。
- `version_details` (Attributes Set) Upstream版本，仅在Upstream来源类型为K8S时有效。
 特别提示: 在使用 ListNestedAttribute 或 SetNestedAttribute 时，必须完整定义其嵌套结构体的所有属性。若定义不完整，Terraform 在执行计划对比时可能会检测到意料之外的差异，从而触发不必要的资源更新，影响资源的稳定性与可预测性。 (see [below for nested schema](#nestedatt--version_details))

<a id="nestedatt--upstream_spec"></a>
### Nested Schema for `upstream_spec`

Optional:

- `ai_provider` (Attributes) AI模型代理。 (see [below for nested schema](#nestedatt--upstream_spec--ai_provider))
- `ecs_instances` (Attributes Set) 云服务器。
 特别提示: 在使用 ListNestedAttribute 或 SetNestedAttribute 时，必须完整定义其嵌套结构体的所有属性。若定义不完整，Terraform 在执行计划对比时可能会检测到意料之外的差异，从而触发不必要的资源更新，影响资源的稳定性与可预测性。 (see [below for nested schema](#nestedatt--upstream_spec--ecs_instances))
- `k8_s_service` (Attributes) 容器服务。 (see [below for nested schema](#nestedatt--upstream_spec--k8_s_service))
- `nacos_service` (Attributes) 注册中心。 (see [below for nested schema](#nestedatt--upstream_spec--nacos_service))
- `ve_faas` (Attributes) 函数服务。 (see [below for nested schema](#nestedatt--upstream_spec--ve_faas))

<a id="nestedatt--upstream_spec--ai_provider"></a>
### Nested Schema for `upstream_spec.ai_provider`

Optional:

- `base_url` (String) 模型地址。
- `custom_model_service` (Attributes) 火山自部署模型服务。 (see [below for nested schema](#nestedatt--upstream_spec--ai_provider--custom_model_service))
- `name` (String) 模型服务商名称。
- `token` (String) 模型API key。

<a id="nestedatt--upstream_spec--ai_provider--custom_model_service"></a>
### Nested Schema for `upstream_spec.ai_provider.custom_model_service`

Optional:

- `name` (String) 模型服务名称。
- `namespace` (String) 命名空间。
- `port` (Number) 端口。



<a id="nestedatt--upstream_spec--ecs_instances"></a>
### Nested Schema for `upstream_spec.ecs_instances`

Optional:

- `ecs_id` (String) 云服务器ID。
- `ip` (String) IP地址。
- `port` (Number) 端口。


<a id="nestedatt--upstream_spec--k8_s_service"></a>
### Nested Schema for `upstream_spec.k8_s_service`

Optional:

- `name` (String) 容器服务名称。长度限制为2~63个字符。
- `namespace` (String) 命名空间。长度限制为2~63个字符。
- `port` (Number) 端口。


<a id="nestedatt--upstream_spec--nacos_service"></a>
### Nested Schema for `upstream_spec.nacos_service`

Optional:

- `group` (String) 分组。
- `namespace` (String) 命名空间。
- `namespace_id` (String) 命名空间ID。
- `service` (String) 服务。
- `upstream_source_id` (String) Upstream来源ID。


<a id="nestedatt--upstream_spec--ve_faas"></a>
### Nested Schema for `upstream_spec.ve_faas`

Optional:

- `function_id` (String) 函数ID。



<a id="nestedatt--circuit_breaking_settings"></a>
### Nested Schema for `circuit_breaking_settings`

Optional:

- `base_ejection_time` (Number) 最小弹出时间。单位为毫秒。取值限制为1~86400000。默认值为30秒。
- `consecutive_errors` (Number) 连续失败次数。取值限制为1~100。默认值为5。
- `enable` (Boolean) 开启。
- `interval` (Number) 计算周期。单位为毫秒。取值限制为1~86400000。默认值为10秒。
- `max_ejection_percent` (Number) 最大熔断比例。取值限制为1~100。默认值为20%。
- `min_health_percent` (Number) 最小健康比例。取值限制为0~100。默认值为60%。


<a id="nestedatt--load_balancer_settings"></a>
### Nested Schema for `load_balancer_settings`

Optional:

- `consistent_hash_lb` (Attributes) 一致性哈希负载均衡。 (see [below for nested schema](#nestedatt--load_balancer_settings--consistent_hash_lb))
- `lb_policy` (String) 负载均衡策略，取值：SimpleLB：简单负载均衡。ConsistentHashLB：一致性哈希负载均衡。
- `simple_lb` (String) 简单负载均衡，取值：ROUND_ROBIN：轮询。LEAST_CONN：最小连接数。RANDOM：随机。
- `warmup_duration` (Number) 预热时间。单位为秒。

<a id="nestedatt--load_balancer_settings--consistent_hash_lb"></a>
### Nested Schema for `load_balancer_settings.consistent_hash_lb`

Optional:

- `hash_key` (String) 一致性哈希方式，取值：UseSourceIp：基于源IP地址。HttpQueryParameterName：基于参数。HttpHeaderName：基于头。HTTPCookie：基于cookie。
- `http_cookie` (Attributes) Cookie。 (see [below for nested schema](#nestedatt--load_balancer_settings--consistent_hash_lb--http_cookie))
- `http_header_name` (String) 参数。支持ASCII可打印字符，长度限制为1~256个字符。
- `http_query_parameter_name` (String) 参数。支持ASCII可打印字符，长度限制为1~256个字符。
- `use_source_ip` (String) 源IP地址。

<a id="nestedatt--load_balancer_settings--consistent_hash_lb--http_cookie"></a>
### Nested Schema for `load_balancer_settings.consistent_hash_lb.http_cookie`

Optional:

- `name` (String) 名称。支持ASCII可打印字符，长度限制为0~256个字符。
- `path` (String) 路径。支持ASCII可打印字符，长度限制为1~256个字符。
- `ttl` (Number) 有效期。单位为秒。




<a id="nestedatt--tls_settings"></a>
### Nested Schema for `tls_settings`

Optional:

- `sni` (String) SNI。留空时会将访问网关的域名透传到upstream。
- `tls_mode` (String) TLS模式，取值：DISABLE：关闭TLS。SIMPLE：单向TLS。


<a id="nestedatt--backend_targets"></a>
### Nested Schema for `backend_targets`

Read-Only:

- `health_status` (String) 健康检查状态。
- `ip` (String) 后端节点IP。
- `port` (Number) 后端节点端口。


<a id="nestedatt--version_details"></a>
### Nested Schema for `version_details`

Read-Only:

- `labels` (Attributes Set) 标签。
 特别提示: 在使用 ListNestedAttribute 或 SetNestedAttribute 时，必须完整定义其嵌套结构体的所有属性。若定义不完整，Terraform 在执行计划对比时可能会检测到意料之外的差异，从而触发不必要的资源更新，影响资源的稳定性与可预测性。 (see [below for nested schema](#nestedatt--version_details--labels))
- `name` (String) 版本名称。支持大小写字母、数字和中划线（-），长度限制为2~63个字符。不能以中划线（-）开头。
- `update_time` (String) 更新时间。

<a id="nestedatt--version_details--labels"></a>
### Nested Schema for `version_details.labels`

Read-Only:

- `key` (String) 键。
- `value` (String) 值。

## Import

Import is supported using the following syntax:

```shell
$ terraform import volcenginecc_apig_upstream.example "upstream_id"
```